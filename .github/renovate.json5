{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:best-practices",
    "security:minimumReleaseAgeNpm", // npmのパッケージの公開直後に起きる問題を回避(サプライチェーン攻撃への対策)
    ":disableDependencyDashboard",
  ],
  labels: ["renovate"],
  customManagers: [
    // ==========================================
    // Terraform (GitHub Actions / Dockerfile)
    // ==========================================
    {
      customType: "regex",
      description: "Terraform version in GitHub Actions",
      managerFilePatterns: [
        "/^\\.github\\/(workflows|actions)\\/.*\\.ya?ml$/",
        "/^action\\.ya?ml$/",
      ],
      matchStrings: [
        "terraform_version:[ \\t]*[\"']?(?<currentValue>[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "hashicorp/terraform",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "terraform_version: {{newValue}}",
    },
    {
      customType: "regex",
      description: "Terraform version in Dockerfile",
      managerFilePatterns: ["/^Dockerfile$/", "/^Dockerfile\\..*$/"],
      matchStrings: [
        "ENV[ \\t]+TERRAFORM_VERSION[=\\s][\"']?(?<currentValue>v?[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "hashicorp/terraform",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "ENV TERRAFORM_VERSION {{newValue}}",
    },
    // ==========================================
    // TFLint (GitHub Actions / Dockerfile)
    // ==========================================
    {
      customType: "regex",
      description: "TFLint version in GitHub Actions",
      managerFilePatterns: [
        "/^\\.github\\/(workflows|actions)\\/.*\\.ya?ml$/",
        "/^action\\.ya?ml$/",
      ],
      matchStrings: [
        "tflint_version:[ \\t]*[\"']?(?<currentValue>[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "terraform-linters/tflint",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "tflint_version: {{newValue}}",
    },
    {
      customType: "regex",
      description: "TFLint version in Dockerfile",
      managerFilePatterns: ["/^Dockerfile$/", "/^Dockerfile\\..*$/"],
      matchStrings: [
        "ENV[ \\t]+TFLINT_VERSION[=\\s][\"']?(?<currentValue>v?[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "terraform-linters/tflint",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "ENV TFLINT_VERSION {{newValue}}",
    },
    // ==========================================
    // tfcmt (GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "tfcmt version in GitHub Actions",
      managerFilePatterns: [
        "/^\\.github\\/(workflows|actions)\\/.*\\.ya?ml$/",
        "/^action\\.ya?ml$/",
      ],
      matchStrings: [
        "TFCMT_VERSION:[ \\t]*[\"']?(?<currentValue>v?[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "suzuki-shunsuke/tfcmt",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "TFCMT_VERSION: {{newValue}}",
    },
    // ==========================================
    // Trivy (Justfile / GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Trivy version in Justfile",
      managerFilePatterns: ["/^justfile$/"],
      matchStrings: [
        "TRIVY_VERSION[ \\t]*:=[ \\t]*[\"'](?<currentValue>[^\"'@\\s]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?[\"']",
      ],
      depNameTemplate: "aquasec/trivy",
      datasourceTemplate: "docker",
      autoReplaceStringTemplate: 'TRIVY_VERSION := "{{newValue}}{{#if newDigest}}@{{newDigest}}{{/if}}"',
    },
    {
      customType: "regex",
      description: "Trivy version in GitHub Actions",
      managerFilePatterns: [
        "/^\\.github\\/(workflows|actions)\\/.*\\.ya?ml$/",
        "/^action\\.ya?ml$/",
      ],
      matchStrings: [
        "TRIVY_VERSION:[ \\t]*[\"']?(?<currentValue>v[^\"'\\s]+)[\"']?",
      ],
      depNameTemplate: "aquasecurity/trivy",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "TRIVY_VERSION: {{newValue}}",
    },
    // ==========================================
    // Yamllint (Justfile / GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Yamllint version in Justfile",
      managerFilePatterns: ["/^justfile$/"],
      matchStrings: [
        "YAMLLINT_VERSION[ \\t]*:=[ \\t]*[\"'](?<currentValue>[^\"'\\s]+)[\"']",
      ],
      depNameTemplate: "adrienverge/yamllint",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: 'YAMLLINT_VERSION := "{{newValue}}"',
    },
    {
      customType: "regex",
      description: "Yamllint version in GitHub Actions",
      managerFilePatterns: ["/^\\.github\\/workflows\\/.*\\.ya?ml$/"],
      matchStrings: [
        "YAMLLINT_VERSION:[ \\t]*[\"']?(?<currentValue>[^\"'\\s]+)[\"']?",
      ],
      depNameTemplate: "adrienverge/yamllint",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: 'YAMLLINT_VERSION: "{{newValue}}"',
    },
    // ==========================================
    // Prettier (Justfile / GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Prettier version in Justfile",
      managerFilePatterns: ["/^justfile$/"],
      matchStrings: [
        "PRETTIER_VERSION[ \\t]*:=[ \\t]*[\"'](?<currentValue>[^\"'\\s]+)[\"']",
      ],
      depNameTemplate: "prettier",
      datasourceTemplate: "npm",
      autoReplaceStringTemplate: 'PRETTIER_VERSION := "{{newValue}}"',
    },
    {
      customType: "regex",
      description: "Prettier version in GitHub Actions",
      managerFilePatterns: ["/^\\.github\\/workflows\\/.*\\.ya?ml$/"],
      matchStrings: [
        "PRETTIER_VERSION:[ \\t]*[\"']?(?<currentValue>[^\"'\\s]+)[\"']?",
      ],
      depNameTemplate: "prettier",
      datasourceTemplate: "npm",
      autoReplaceStringTemplate: 'PRETTIER_VERSION: "{{newValue}}"',
    },
    // ==========================================
    // Golang (GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Go version in composite actions",
      managerFilePatterns: ["/action\\.ya?ml$/"],
      matchStrings: [
        "default:[ \\t]*[\"'](?<currentValue>[^\"'\\s]+)[\"'][ \\t]*#[ \\t]*renovate:[ \\t]*datasource=golang-version depName=go",
      ],
      depNameTemplate: "go",
      datasourceTemplate: "golang-version",
      autoReplaceStringTemplate: 'default: "{{newValue}}" # renovate: datasource=golang-version depName=go',
    },
    // ==========================================
    // Task (Dockerfile / GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Task version in Dockerfile",
      managerFilePatterns: ["/^Dockerfile\\.golang$/"],
      matchStrings: [
        "ENV[ \\t]+TASK_VERSION[=\\s][\"']?(?<currentValue>v?[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "go-task/task",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: "ENV TASK_VERSION {{newValue}}",
    },
    {
      customType: "regex",
      description: "Task version in composite actions",
      managerFilePatterns: ["/action\\.ya?ml$/"],
      matchStrings: [
        "default:[ \\t]*[\"'](?<currentValue>[^\"'\\s]+)[\"'][ \\t]*#[ \\t]*renovate:[ \\t]*datasource=github-releases depName=go-task/task",
      ],
      depNameTemplate: "go-task/task",
      datasourceTemplate: "github-releases",
      autoReplaceStringTemplate: 'default: "{{newValue}}" # renovate: datasource=github-releases depName=go-task/task',
    },
    // ==========================================
    // Node.js (GitHub Actions)
    // ==========================================
    {
      customType: "regex",
      description: "Node.js version in GitHub Actions",
      managerFilePatterns: ["/^\\.github\\/workflows\\/.*\\.ya?ml$/"],
      matchStrings: [
        "NODE_VERSION:[ \\t]*[\"']?(?<currentValue>[\\d\\.]+)[\"']?",
      ],
      depNameTemplate: "node",
      datasourceTemplate: "docker",
      autoReplaceStringTemplate: "NODE_VERSION: {{newValue}}",
    },
    // ==========================================
    // Renovate (Justfile)
    // ==========================================
    {
      customType: "regex",
      description: "Renovate version in Justfile",
      managerFilePatterns: ["/^justfile$/"],
      matchStrings: [
        "RENOVATE_VERSION[ \\t]*:=[ \\t]*[\"'](?<currentValue>[^\"'@\\s]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?[\"']",
      ],
      depNameTemplate: "renovate/renovate",
      datasourceTemplate: "docker",
      autoReplaceStringTemplate: 'RENOVATE_VERSION := "{{newValue}}{{#if newDigest}}@{{newDigest}}{{/if}}"',
    },
  ],
  packageRules: [
    {
      matchUpdateTypes: ["lockFileMaintenance"],
      schedule: ["before 9am on saturday"],
      timezone: "Asia/Tokyo",
    },
    {
      groupName: "Node.js Version",
      matchPackageNames: ["node"],
      matchDatasources: ["docker"],
      minimumReleaseAge: "3 days",
    },
    {
      groupName: "Node.js Version",
      matchPackageNames: ["node"],
      matchManagers: ["custom.regex"],
      pinDigests: false,
    },
    {
      groupName: "Terraform Version",
      matchPackageNames: ["hashicorp/terraform", "terraform"],
    },
    {
      groupName: "Go Ecosystem",
      matchPackageNames: ["/^go$/", "/golang/"],
    },
    {
      groupName: "TFLint Version",
      matchPackageNames: ["/tflint/"],
    },
    {
      groupName: "Task Version",
      matchPackageNames: ["/go-task/task/"],
    },
    {
      groupName: "Trivy Version",
      matchPackageNames: ["/trivy/"],
    },
    {
      matchPackageNames: ["/trivy/"],
      matchDatasources: ["docker"],
      pinDigests: true,
    },
    {
      groupName: "uv Version",
      matchPackageNames: [
        "/ghcr\\.io\\/astral-sh\\/uv\\//",
        "/astral-sh\\/uv\\//",
      ],
    },
    {
      groupName: "YamlLint Version",
      matchPackageNames: ["/yamllint/"],
    },
    {
      groupName: "Prettier Version",
      matchPackageNames: ["/prettier/"],
    },
    {
      groupName: "Renovate Docker Digest",
      matchDatasources: ["docker"],
      matchPackageNames: ["renovate/renovate"],
      pinDigests: true,
      separateMajorMinor: false,
    },
    {
      matchUpdateTypes: ["major", "minor", "patch"],
      commitMessageAction: "update",
      commitMessageTopic: "{{depName}}",
      commitMessageExtra: "to {{newVersion}}",
    },
  ],
}
